<!DOCTYPE html>
<html lang="de">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content=
"width=device-width, initial-scale=1">
<title>EPS-Dokumentation | Proxy Service - Übersicht</title>
<link rel="stylesheet" type="text/css" href=
"/eps/docs/static/css/main.css">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="/eps/docs/static/js/mathjax/tex-chtml.js" id=
"MathJax-script" async></script>
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #8f5902; font-style: italic } /* Comment */
.codehilite .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.codehilite .g { color: #000000 } /* Generic */
.codehilite .k { color: #204a87; font-weight: bold } /* Keyword */
.codehilite .l { color: #000000 } /* Literal */
.codehilite .n { color: #000000 } /* Name */
.codehilite .o { color: #ce5c00; font-weight: bold } /* Operator */
.codehilite .x { color: #000000 } /* Other */
.codehilite .p { color: #000000; font-weight: bold } /* Punctuation */
.codehilite .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.codehilite .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #a40000 } /* Generic.Deleted */
.codehilite .ge { color: #000000; font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #ef2929 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #000000; font-style: italic } /* Generic.Output */
.codehilite .gp { color: #8f5902 } /* Generic.Prompt */
.codehilite .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.codehilite .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.codehilite .ld { color: #000000 } /* Literal.Date */
.codehilite .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.codehilite .s { color: #4e9a06 } /* Literal.String */
.codehilite .na { color: #c4a000 } /* Name.Attribute */
.codehilite .nb { color: #204a87 } /* Name.Builtin */
.codehilite .nc { color: #000000 } /* Name.Class */
.codehilite .no { color: #000000 } /* Name.Constant */
.codehilite .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #ce5c00 } /* Name.Entity */
.codehilite .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #000000 } /* Name.Function */
.codehilite .nl { color: #f57900 } /* Name.Label */
.codehilite .nn { color: #000000 } /* Name.Namespace */
.codehilite .nx { color: #000000 } /* Name.Other */
.codehilite .py { color: #000000 } /* Name.Property */
.codehilite .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #000000 } /* Name.Variable */
.codehilite .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.codehilite .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.codehilite .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.codehilite .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.codehilite .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.codehilite .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.codehilite .sa { color: #4e9a06 } /* Literal.String.Affix */
.codehilite .sb { color: #4e9a06 } /* Literal.String.Backtick */
.codehilite .sc { color: #4e9a06 } /* Literal.String.Char */
.codehilite .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.codehilite .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4e9a06 } /* Literal.String.Double */
.codehilite .se { color: #4e9a06 } /* Literal.String.Escape */
.codehilite .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.codehilite .si { color: #4e9a06 } /* Literal.String.Interpol */
.codehilite .sx { color: #4e9a06 } /* Literal.String.Other */
.codehilite .sr { color: #4e9a06 } /* Literal.String.Regex */
.codehilite .s1 { color: #4e9a06 } /* Literal.String.Single */
.codehilite .ss { color: #4e9a06 } /* Literal.String.Symbol */
.codehilite .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #000000 } /* Name.Function.Magic */
.codehilite .vc { color: #000000 } /* Name.Variable.Class */
.codehilite .vg { color: #000000 } /* Name.Variable.Global */
.codehilite .vi { color: #000000 } /* Name.Variable.Instance */
.codehilite .vm { color: #000000 } /* Name.Variable.Magic */
.codehilite .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<div id="translation-notice">
<div class="message is-info">
<div class="message-body">
<p>Diese Website wurde größtenteils automatisch von der <a href=
"/eps/docs/proxy-service">englischen Version</a> übersetzt. Wir
entschuldigen uns für eventuelle Übersetzungsfehler.</p>
<span class="x" onclick=
"localStorage.setItem('translation-notice', true);notice.style.display = 'none'">x</span></div>
</div>
</div>
<script>
var notice = document.getElementById("translation-notice")
if (localStorage.getItem("translation-notice") === null && notice !== null){
        notice.style.display = "block"
}
</script>
<nav class="navbar is-dark">
<div class="navbar-brand"><span class="navbar-burger burger"
data-target="side-menu" data-toggle="collapse"><span>&nbsp;</span>
<span>&nbsp;</span> <span>&nbsp;</span></span></div>
</nav>
<div class="main">
<div class="side-menu" id="side-menu" data-toggle-class=
"is-active">
<aside class="menu">
<p class="menu-label" style="text-align:center"><a href=
"/eps/de/doku">EPS-Dokumentation</a></p>
<ul class="menu-list">
<li><a href="/eps/de/doku">Start</a></li>
<li><a href="/eps/de/doku/getting-started">Erste Schritte</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-eps-nav">EPS Service</a>
<ul class="is-hidden" id="page-eps-nav">
<li><a href="/eps/de/doku/eps-service">Übersicht</a></li>
</ul>
</li>
<li><a class="is-active" href="#" data-toggle="collapse"
data-target="page-proxy-nav">Proxy Service</a>
<ul class="" id="page-proxy-nav">
<li><a href="/eps/de/doku/proxy-service">Übersicht</a></li>
<li><a href=
"/eps/de/doku/proxy-service/installation">Installation</a></li>
<li><a href=
"/eps/de/doku/proxy-service/configuration">Konfiguration</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-sd-nav">Service Directory</a>
<ul class="is-hidden" id="page-sd-nav">
<li><a href="/eps/de/doku/service-directory">Übersicht</a></li>
<li><a href=
"/eps/de/doku/service-directory/installation">Installation</a></li>
<li><a href=
"/eps/de/doku/service-directory/configuration">Konfiguration</a></li>
</ul>
</li>
<li><a href="/eps/de/doku/kontakt">Kontakt</a></li>
<li><a href="#" data-toggle="collapse" data-target=
"menu-language-dropdown">Sprachen</a>
<ul id="menu-language-dropdown" class="is-hidden">
<li><a class="" href="/eps/docs/proxy-service">English</a></li>
<li><a class="is-open is-active" href=
"/eps/de/doku/proxy-service">Deutsch</a></li>
</ul>
</li>
</ul>
</aside>
</div>
<div class="with-comments">
<div class="comments"></div>
<section class="section first">
<div class="content">
<div class="content markdown">
<h1>Der EPS TLS-Passthrough-Proxy</h1>
<p>Der EPS-Server bietet einen TLS-Passthrough-Proxy-Dienst, der
eingehende TLS-Verbindungen von öffentlichen Clients an einen
internen Server weiterleiten kann, ohne die TLS-Verbindung zu
beenden. Der Dienst besteht aus zwei Servern:</p>
<ul>
<li>Ein <strong>öffentlicher Proxy</strong>, der auf einem
öffentlich zugänglichen TCP-Port auf eingehende TLS-Verbindungen
lauscht und auf einem anderen TCP-Port auf Verbindungen von
privaten Proxy-Servern.</li>
<li>Ein <strong>privater Proxy</strong>, der auf keinem TCP-Port
lauscht und sich stattdessen aktiv mit dem öffentlichen
Proxy-Server verbindet, wenn eine Verbindung für ihn verfügbar ist.
Er leitet diese Verbindung (wiederum ohne TLS zu beenden) an einen
internen Server weiter, der sie dann bearbeitet.</li>
</ul>
<p>Sowohl die privaten als auch die öffentlichen Proxys haben
zugehörige EPS-Server, über die sie miteinander kommunizieren.</p>
<p>Der private Proxy kann eingehende Verbindungen an den
öffentlichen Proxy <strong>ankündigen</strong>. Immer wenn eine
neue Verbindung diesen Proxy erreicht, vergleicht er sie mit den
Ankündigungen, die er erhalten hat. Wenn eine Übereinstimmung
gefunden wird, benachrichtigt er den privaten Proxy über eine
eingehende Verbindung über das EPS-Netzwerk und sendet ihm außerdem
ein zufälliges Token. Der private Proxy öffnet eine Verbindung zum
öffentlichen Proxy, sendet das Token und übernimmt den TCP-Stream.
Er leitet ihn an einen internen Server weiter.</p>
<h2>Demo</h2>
<p>Um diesen Mechanismus zu demonstrieren, haben wir eine
Beispielkonfiguration vorbereitet. Führen Sie einfach die folgenden
Schnipsel in verschiedenen Terminals aus (aus dem Hauptverzeichnis
im Repository):</p>
<div class="codehilite">
<pre><code><span class="c1"># prepare the binaries</span>
make <span class="o">&amp;&</span> make examples
<span class="c1"># first terminal</span>
internal-server <span class=
"c1">#will open a JSON-RPC server on port 8888</span>
<span class="c1"># second terminal (public proxy)</span>
<span class="nv">PROXY_SETTINGS</span><span class=
"o">=</span>settings/dev/roles/public-proxy-1 proxy run public
<span class="c1"># third terminal (private proxy)</span>
<span class="nv">PROXY_SETTINGS</span><span class=
"o">=</span>settings/dev/roles/private-proxy-1 proxy run private
<span class="c1"># fourth terminal (public proxy EPS server)</span>
<span class="nv">EPS_SETTINGS</span><span class=
"o">=</span>settings/dev/roles/public-proxy-eps-1 eps server run
<span class="c1"># fifth terminal (private proxy EPS server)</span>
<span class="nv">EPS_SETTINGS</span><span class=
"o">=</span>settings/dev/roles/private-proxy-eps-1 eps server run
</code></pre></div>
<p>Wenn alle Dienste laufen, sollten Sie in der Lage sein, eine
Anfrage an den Proxy zu senden über</p>
<div class="codehilite">
<pre><code>curl --cacert settings/dev/certs/root.crt --resolve test.internal-server.local:4433:127.0.0.1 https://test.internal-server.local:4433/jsonrpc <span class="p">|</span> jq .
</code></pre></div>
<p>Dies sollte die folgenden JSON-Daten zurückgeben:</p>
<div class="codehilite">
<pre><code><span class="p">{</span>
  <span class="nt">"message"</span><span class=
"p">:</span> <span class="s2">"success"</span>
<span class="p">}</span>
</code></pre></div>
<p>Die Anfrage, die Sie gesendet haben, erreichte den lokalen
TLS-Server auf Port 8888 über die beiden Proxys, die über das
EPS-Netzwerk kommunizierten, um die Verbindung zu vermitteln. Toll,
nicht wahr?</p>
<h2>Stresstest</h2>
<p>Sie können den Server auch einem Stresstest mit parallelen
Anfragen unterziehen, indem Sie den <code>parallel</code>
verwenden:</p>
<div class="codehilite">
<pre><code>eq <span class="m">1</span> <span class=
"m">2000000</span> <span class=
"p">|</span> parallel -j <span class="m">25</span> curl --cacert settings/dev/certs/root.crt --resolve test.internal-server.local:4433:127.0.0.1 https://test.internal-server.local:4433/jsonrpc --data <span class="s2">"{}"</span>
</code></pre></div>
<p>Dadurch wird versucht, 25 Anfragen parallel an den Server zu
senden.</p>
</div>
</div>
</section>
</div>
</div>
<script defer type="text/javascript" src=
"/eps/docs/static/js/bulma.js"></script>
</body>
</html>
