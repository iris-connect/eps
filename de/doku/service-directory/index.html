<!DOCTYPE html>
<html lang="de">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content=
"width=device-width, initial-scale=1">
<title>EPS-Dokumentation | Service Directory - Übersicht</title>
<link rel="stylesheet" type="text/css" href=
"/docs/static/css/main.css">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="/docs/static/js/mathjax/tex-chtml.js" id=
"MathJax-script" async></script>
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .tango .hll { background-color: #ffffcc }
.highlight .tango { background: #f8f8f8; }
.highlight .tango .c { color: #8f5902; font-style: italic } /* Comment */
.highlight .tango .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.highlight .tango .g { color: #000000 } /* Generic */
.highlight .tango .k { color: #204a87; font-weight: bold } /* Keyword */
.highlight .tango .l { color: #000000 } /* Literal */
.highlight .tango .n { color: #000000 } /* Name */
.highlight .tango .o { color: #ce5c00; font-weight: bold } /* Operator */
.highlight .tango .x { color: #000000 } /* Other */
.highlight .tango .p { color: #000000; font-weight: bold } /* Punctuation */
.highlight .tango .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.highlight .tango .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.highlight .tango .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.highlight .tango .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.highlight .tango .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.highlight .tango .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.highlight .tango .gd { color: #a40000 } /* Generic.Deleted */
.highlight .tango .ge { color: #000000; font-style: italic } /* Generic.Emph */
.highlight .tango .gr { color: #ef2929 } /* Generic.Error */
.highlight .tango .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .tango .gi { color: #00A000 } /* Generic.Inserted */
.highlight .tango .go { color: #000000; font-style: italic } /* Generic.Output */
.highlight .tango .gp { color: #8f5902 } /* Generic.Prompt */
.highlight .tango .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.highlight .tango .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .tango .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.highlight .tango .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.highlight .tango .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.highlight .tango .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.highlight .tango .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.highlight .tango .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.highlight .tango .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.highlight .tango .ld { color: #000000 } /* Literal.Date */
.highlight .tango .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.highlight .tango .s { color: #4e9a06 } /* Literal.String */
.highlight .tango .na { color: #c4a000 } /* Name.Attribute */
.highlight .tango .nb { color: #204a87 } /* Name.Builtin */
.highlight .tango .nc { color: #000000 } /* Name.Class */
.highlight .tango .no { color: #000000 } /* Name.Constant */
.highlight .tango .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.highlight .tango .ni { color: #ce5c00 } /* Name.Entity */
.highlight .tango .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.highlight .tango .nf { color: #000000 } /* Name.Function */
.highlight .tango .nl { color: #f57900 } /* Name.Label */
.highlight .tango .nn { color: #000000 } /* Name.Namespace */
.highlight .tango .nx { color: #000000 } /* Name.Other */
.highlight .tango .py { color: #000000 } /* Name.Property */
.highlight .tango .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.highlight .tango .nv { color: #000000 } /* Name.Variable */
.highlight .tango .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.highlight .tango .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.highlight .tango .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.highlight .tango .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.highlight .tango .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.highlight .tango .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.highlight .tango .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.highlight .tango .sa { color: #4e9a06 } /* Literal.String.Affix */
.highlight .tango .sb { color: #4e9a06 } /* Literal.String.Backtick */
.highlight .tango .sc { color: #4e9a06 } /* Literal.String.Char */
.highlight .tango .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.highlight .tango .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.highlight .tango .s2 { color: #4e9a06 } /* Literal.String.Double */
.highlight .tango .se { color: #4e9a06 } /* Literal.String.Escape */
.highlight .tango .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.highlight .tango .si { color: #4e9a06 } /* Literal.String.Interpol */
.highlight .tango .sx { color: #4e9a06 } /* Literal.String.Other */
.highlight .tango .sr { color: #4e9a06 } /* Literal.String.Regex */
.highlight .tango .s1 { color: #4e9a06 } /* Literal.String.Single */
.highlight .tango .ss { color: #4e9a06 } /* Literal.String.Symbol */
.highlight .tango .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.highlight .tango .fm { color: #000000 } /* Name.Function.Magic */
.highlight .tango .vc { color: #000000 } /* Name.Variable.Class */
.highlight .tango .vg { color: #000000 } /* Name.Variable.Global */
.highlight .tango .vi { color: #000000 } /* Name.Variable.Instance */
.highlight .tango .vm { color: #000000 } /* Name.Variable.Magic */
.highlight .tango .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<script>
var notice = document.getElementById("translation-notice")
if (localStorage.getItem("translation-notice") === null && notice !== null){
        notice.style.display = "block"
}
</script>
<nav class="navbar is-dark">
<div class="navbar-brand"><span class="navbar-burger burger"
data-target="side-menu" data-toggle="collapse"><span>&nbsp;</span>
<span>&nbsp;</span> <span>&nbsp;</span></span></div>
</nav>
<div class="main">
<div class="side-menu" id="side-menu" data-toggle-class=
"is-active">
<aside class="menu">
<p class="menu-label" style="text-align:center"><a href=
"/de/doku">EPS-Dokumentation</a></p>
<ul class="menu-list">
<li><a href="/de/doku">Start</a></li>
<li><a href="/de/doku/getting-started">Erste Schritte</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-eps-nav">EPS Service</a>
<ul class="is-hidden" id="page-eps-nav">
<li><a href="/de/doku/eps-service">Übersicht</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-proxy-nav">Proxy Service</a>
<ul class="is-hidden" id="page-proxy-nav">
<li><a href="/de/doku/proxy-service">Übersicht</a></li>
<li><a href=
"/de/doku/proxy-service/installation">Installation</a></li>
<li><a href=
"/de/doku/proxy-service/configuration">Konfiguration</a></li>
</ul>
</li>
<li><a class="is-active" href="#" data-toggle="collapse"
data-target="page-sd-nav">Service Directory</a>
<ul class="" id="page-sd-nav">
<li><a href="/de/doku/service-directory">Übersicht</a></li>
<li><a href=
"/de/doku/service-directory/installation">Installation</a></li>
<li><a href=
"/de/doku/service-directory/configuration">Konfiguration</a></li>
</ul>
</li>
<li><a href="/de/doku/kontakt">Kontakt</a></li>
<li><a href="#" data-toggle="collapse" data-target=
"menu-language-dropdown">Sprachen</a>
<ul id="menu-language-dropdown" class="is-hidden">
<li><a class="" href="/docs/service-directory">English</a></li>
<li><a class="is-open is-active" href=
"/de/doku/service-directory">Deutsch</a></li>
</ul>
</li>
</ul>
</aside>
</div>
<div class="with-comments">
<div class="comments"></div>
<section class="section first">
<div class="content">
<div class="content markdown">
<h1>Service-Verzeichnis</h1>
<p>Das Dienstverzeichnis ist eine zentrale Datenbank, die
Informationen über alle Betreiber im IRIS-Ökosystem enthält. Es
enthält Informationen darüber, wie die Betreiber erreicht werden
können und welche Dienste sie anbieten.</p>
<p>Mit Hilfe des Verzeichnisses können EPS-Server feststellen, ob
und wie sie sich mit einem anderen Betreiber verbinden können.
Betreiber, die nur über ausgehende Verbindungen verfügen (z. B.
<code>ga-leipzig</code> im obigen Beispiel), können das Verzeichnis
verwenden, um zu erfahren, dass sie möglicherweise asynchrone
Antworten von anderen Betreibern (z. B. <code>ls-1</code>) erhalten
und dann ausgehende Verbindungen zu diesen Betreibern öffnen, über
die sie Antworten erhalten können. EPS-Server können das
Dienstverzeichnis auch verwenden, um festzustellen, ob sie eine
Nachricht von einem bestimmten Betreiber annehmen sollen.</p>
<p>Das Dienstverzeichnis implementiert einen gruppenbasierten
Berechtigungsmechanismus. Derzeit existieren nur
<code>yes/no</code> Berechtigungen (d. h. ein Mitglied einer
bestimmten Gruppe kann eine bestimmte Dienstmethode entweder
aufrufen oder nicht). Feinkörnigere Berechtigungen (z. B. kann ein
Anbieter von Kontaktverfolgungen nur seine eigenen Einträge im
Dienst "Standorte" bearbeiten) müssen von den Diensten selbst
implementiert werden. Zu diesem Zweck stellt der EPS-Server den
Diensten Informationen über die aufrufende Gegenstelle über einen
speziellen Parameter (<code>_caller</code>) zur Verfügung, der
zusammen mit den anderen RPC-Methodenparametern übergeben wird.
Diese Struktur enthält auch den aktuellen Eintrag des Aufrufers aus
dem Dienstverzeichnis, was es dem aufgerufenen Dienst erleichtert,
den Aufrufer zu identifizieren und zu autorisieren.</p>
<h2>Dienstverzeichnis-API</h2>
<p>Das EPS-Serverpaket bietet auch einen <code>sd</code>
API-Server-Befehl, der einen JSON-RPC-Server öffnet, der das
Dienstverzeichnis verteilt.</p>
<p><code>`bash SD_SETTINGS=settings/dev/roles/sd-1 sd run</code>
`</p>
<p>Standardmäßig werden damit Änderungsdatensätze in einer Datei
gespeichert und abgerufen, die sich unter
<code>/tmp/service-directory.records</code> befindet. Um das
Dienstverzeichnis zurückzusetzen, löschen Sie einfach diese
Datei.</p>
<h2>Signatur-Schema</h2>
<p>Alle Änderungen im Dienstverzeichnis werden kryptografisch
signiert. Dazu besitzt jeder Akteur im EPS-System ein Paar
ECDSA-Schlüssel und ein dazugehöriges Zertifikat. Das
Serviceverzeichnis ist aus einer Reihe von
<strong>Änderungsdatensätzen</strong> aufgebaut. Jeder
Änderungssatz enthält den Namen eines <strong>Akteurs</strong>,
einen <strong>Abschnitt</strong> und die eigentlichen Daten, die
geändert werden sollen.</p>
<h3>Einreichen von Änderungsdatensätzen</h3>
<p>Änderungsdatensätze können über die JSON-RPC-API an das
Dienstverzeichnis übermittelt werden. Die <code>eps</code> CLI
bietet dafür eine Funktion über die <code>sd submit-records</code>
:</p>
<p><code>`bash EPS_SETTINGS=settings/dev/roles/hd-1 eps sd
submit-records settings/dev/directory/001_base.json</code> `</p>
<p>Sie können das Dienstverzeichnis auch zurücksetzen, indem Sie
das Flag <code>--reset</code> angeben:</p>
<p><code>` EPS_SETTINGS=settings/dev/roles/hd-1 eps sd
submit-records --reset settings/dev/directory/001_base.json</code>
`</p>
<p><strong>Warnung:</strong> Dadurch werden alle vorherigen
Datensätze aus dem Dienstverzeichnis gelöscht. Nur Bediener mit
einer <code>sd-admin</code> Rolle können dies tun.</p>
<h3>Abrufen von Einträgen und Datensätzen</h3>
<p>Um Änderungsdatensätze und -einträge von der
Dienstverzeichnis-API abzurufen, können Sie die RPC-Aufrufe
<code>getRecords(since)</code>, <code>getEntries()</code> und
<code>getEntry(name)</code> verwenden, z. B. wie folgt:</p>
<p><code>`bash curl --key settings/dev/certs/hd-1.key --cert
settings/dev/certs/hd-1.crt --cacert settings/dev/certs/root.crt
--resolve sd-1:3322:127.0.0.1 https://sd-1:3322/jsonrpc --header
"Content-Type: application/json" --data '{"jsonrpc": "2.0",
"method": "getRecords", "params": {"since": 0}}'</code> `</p>
<h3>Signierdaten</h3>
<p>Das Tool <code>sdh</code> enthält einen Befehl
<code>sign</code>, mit dem wir beliebige JSON-Daten signieren
können. Er verwendet die Signaturen, die mit dem Befehl <code>make
certs</code> Make erzeugt werden. Um zum Beispiel eine JSON-Datei
zu signieren, verwenden Sie einfach</p>
<p>`</p>
<h1>definieren die SD-Einstellungen</h1>
<p>export SD_SETTINGS=settings/dev/roles/private-proxy-1/sdh</p>
<h1>einen Dienstverzeichniseintrag signieren</h1>
<p>sdh sign settings/dev/roles/private-proxy-1/sdh/entry.json `</p>
<p>Die Ausgabe sollte z. B. so aussehen:</p>
<p><code>`json { "Signatur": { "r":
"67488385997031737348502334621054744305438368369525250023542608571625588981387",
"s":
"110557266089828975725234959115295121652814407881082688883738138814924173982570",
"c": "-----BEGIN
CERTIFICATE-----\nMIIC1TCCAb2gAwIBAgIUe3+081Bi4Z0DXDdeBhfZZOAs4OwwDQYJKoZIhvcNAQEL\nBQAwaTELMAkGA1UEBhMCREUxDzANBgNVBAgMBkJlcmxpbjEPMA0GA1UEBwwGQmVy\nbGluMQ0wCwYDVQQKDARJUklTMQswCQYDVQQLDAJJVDEcMBoGA1UEAwwTVGVzdGlu\nZy1EZXZlbG9wbWVudDAeFw0yMTA1MTExMTMzNDBaFw0yMjA5MjMxMTMzNDBaMGUx\nCzAJBgNVBAYTAkRFMQ8wDQYDVQQIDAZCZXJsaW4xDzANBgNVBAcMBkJlcmxpbjEN\nMAsGA1UECgwESVJJUzELMAkGA1UECwwCSVQxGDAWBgNVBAMMD3ByaXZhdGUtcHJv\neHktMTBZMBMGByqGSM49AgEGCCqGSM49AwEHA0IABLHlILI5POvEDJc96W0dbag7\nFt8BVmitGqwS5jarYRwOUe/PiQ8tMBkMw9X/2U8G1qGYQb/CiRDh1DDy/Eh/mGKj\nRDBCMDMGA1UdEQQsMCqCD3ByaXZhdGUtcHJveHktMYIXKi5wcml2YXRlLXByb3h5\nLTEubG9jYWwwCwYDVR0PBAQDAgeAMA0GCSqGSIb3DQEBCwUAA4IBAQAmUESzD1ls\nmpECtRlinhiUduif9nVddtLeW/Ui86PHkS50vjSOVHY7ZHrfWbFB4/p4bwm8Sp1/\npFHx4WyuHiow5Ah3HV9afDcgyWBd1V8ijIFOlNF27u/caVsa9gV7iDVJ+6mBXKkf\nCgNI2bA2WoOVXQMwRoow4vSYrVAdM/Eyq8PHYOHkGqdd4uASG5df4vE+gnB2z9WD\nFuxkVYkncVP5OB+N7EAkQrVjrITdiSN0yYAVWFKz1IEnPF7GRW6KsPHW9lJeePeD\n1gLNh2KF6drrXT2PIIYVB31uepSoCqFnUUDcC/PX0qHu8jilvr/pTzhFUWbuX+Ja\nfaIRxqWB0frZ\n-----END
ZERTIFIKAT-----\n" }, "Daten": { "foo": "bar", "Name":
"Privat-Proxy-1" } }</code> `</p>
<p>Bevor wir solche Daten importieren, können wir die Signatur mit
dem Befehl <code>verify</code> überprüfen (Sie müssen die erwartete
<code>name</code> des Unterzeichners angeben):</p>
<p><code>`bash export SD_SETTINGS=settings/dev/roles/sd-1/sdh sdh
verify signed.json private-proxy-1</code> `</p>
<p>Wenn die Signatur gültig ist, lautet der Exit-Code
<code>0</code>, andernfalls <code>1</code>.</p>
</div>
</div>
</section>
</div>
</div>
<script defer type="text/javascript" src=
"/docs/static/js/bulma.js"></script>
</body>
</html>
