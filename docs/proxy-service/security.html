<!DOCTYPE html>
<html lang="en">
<head>
<meta name="generator" content=
"HTML Tidy for HTML5 for Linux version 5.6.0">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content=
"width=device-width, initial-scale=1">
<title>EPS documentation | Proxy Service - Security & Threat
Model</title>
<link rel="stylesheet" type="text/css" href=
"/eps/docs/static/css/main.css">
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    },
    svg: {
      fontCache: 'global'
    }
  };
</script>
<script src="/eps/docs/static/js/mathjax/tex-chtml.js" id=
"MathJax-script" async></script>
<style type="text/css">
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.codehilite .hll { background-color: #ffffcc }
.codehilite { background: #f8f8f8; }
.codehilite .c { color: #8f5902; font-style: italic } /* Comment */
.codehilite .err { color: #a40000; border: 1px solid #ef2929 } /* Error */
.codehilite .g { color: #000000 } /* Generic */
.codehilite .k { color: #204a87; font-weight: bold } /* Keyword */
.codehilite .l { color: #000000 } /* Literal */
.codehilite .n { color: #000000 } /* Name */
.codehilite .o { color: #ce5c00; font-weight: bold } /* Operator */
.codehilite .x { color: #000000 } /* Other */
.codehilite .p { color: #000000; font-weight: bold } /* Punctuation */
.codehilite .ch { color: #8f5902; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #8f5902; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #8f5902; font-style: italic } /* Comment.Preproc */
.codehilite .cpf { color: #8f5902; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #8f5902; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #8f5902; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #a40000 } /* Generic.Deleted */
.codehilite .ge { color: #000000; font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #ef2929 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #000000; font-style: italic } /* Generic.Output */
.codehilite .gp { color: #8f5902 } /* Generic.Prompt */
.codehilite .gs { color: #000000; font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #a40000; font-weight: bold } /* Generic.Traceback */
.codehilite .kc { color: #204a87; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #204a87; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #204a87; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #204a87; font-weight: bold } /* Keyword.Pseudo */
.codehilite .kr { color: #204a87; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #204a87; font-weight: bold } /* Keyword.Type */
.codehilite .ld { color: #000000 } /* Literal.Date */
.codehilite .m { color: #0000cf; font-weight: bold } /* Literal.Number */
.codehilite .s { color: #4e9a06 } /* Literal.String */
.codehilite .na { color: #c4a000 } /* Name.Attribute */
.codehilite .nb { color: #204a87 } /* Name.Builtin */
.codehilite .nc { color: #000000 } /* Name.Class */
.codehilite .no { color: #000000 } /* Name.Constant */
.codehilite .nd { color: #5c35cc; font-weight: bold } /* Name.Decorator */
.codehilite .ni { color: #ce5c00 } /* Name.Entity */
.codehilite .ne { color: #cc0000; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #000000 } /* Name.Function */
.codehilite .nl { color: #f57900 } /* Name.Label */
.codehilite .nn { color: #000000 } /* Name.Namespace */
.codehilite .nx { color: #000000 } /* Name.Other */
.codehilite .py { color: #000000 } /* Name.Property */
.codehilite .nt { color: #204a87; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #000000 } /* Name.Variable */
.codehilite .ow { color: #204a87; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #f8f8f8; text-decoration: underline } /* Text.Whitespace */
.codehilite .mb { color: #0000cf; font-weight: bold } /* Literal.Number.Bin */
.codehilite .mf { color: #0000cf; font-weight: bold } /* Literal.Number.Float */
.codehilite .mh { color: #0000cf; font-weight: bold } /* Literal.Number.Hex */
.codehilite .mi { color: #0000cf; font-weight: bold } /* Literal.Number.Integer */
.codehilite .mo { color: #0000cf; font-weight: bold } /* Literal.Number.Oct */
.codehilite .sa { color: #4e9a06 } /* Literal.String.Affix */
.codehilite .sb { color: #4e9a06 } /* Literal.String.Backtick */
.codehilite .sc { color: #4e9a06 } /* Literal.String.Char */
.codehilite .dl { color: #4e9a06 } /* Literal.String.Delimiter */
.codehilite .sd { color: #8f5902; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #4e9a06 } /* Literal.String.Double */
.codehilite .se { color: #4e9a06 } /* Literal.String.Escape */
.codehilite .sh { color: #4e9a06 } /* Literal.String.Heredoc */
.codehilite .si { color: #4e9a06 } /* Literal.String.Interpol */
.codehilite .sx { color: #4e9a06 } /* Literal.String.Other */
.codehilite .sr { color: #4e9a06 } /* Literal.String.Regex */
.codehilite .s1 { color: #4e9a06 } /* Literal.String.Single */
.codehilite .ss { color: #4e9a06 } /* Literal.String.Symbol */
.codehilite .bp { color: #3465a4 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #000000 } /* Name.Function.Magic */
.codehilite .vc { color: #000000 } /* Name.Variable.Class */
.codehilite .vg { color: #000000 } /* Name.Variable.Global */
.codehilite .vi { color: #000000 } /* Name.Variable.Instance */
.codehilite .vm { color: #000000 } /* Name.Variable.Magic */
.codehilite .il { color: #0000cf; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body>
<script>
var notice = document.getElementById("translation-notice")
if (localStorage.getItem("translation-notice") === null && notice !== null){
        notice.style.display = "block"
}
</script>
<nav class="navbar is-dark">
<div class="navbar-brand"><span class="navbar-burger burger"
data-target="side-menu" data-toggle="collapse"><span>&nbsp;</span>
<span>&nbsp;</span> <span>&nbsp;</span></span></div>
</nav>
<div class="main">
<div class="side-menu" id="side-menu" data-toggle-class=
"is-active">
<aside class="menu">
<p class="menu-label" style="text-align:center"><a href=
"/eps/docs">EPS documentation</a></p>
<ul class="menu-list">
<li><a href="/eps/docs">Start</a></li>
<li><a href="/eps/docs/getting-started">Getting Started</a></li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-eps-nav">EPS Service</a>
<ul class="is-hidden" id="page-eps-nav">
<li><a href="/eps/docs/eps-service">Overview</a></li>
</ul>
</li>
<li><a class="is-active" href="#" data-toggle="collapse"
data-target="page-proxy-nav">Proxy Service</a>
<ul class="" id="page-proxy-nav">
<li><a href="/eps/docs/proxy-service">Overview</a></li>
<li><a href=
"/eps/docs/proxy-service/installation">Installation</a></li>
<li><a href=
"/eps/docs/proxy-service/configuration">Configuration</a></li>
<li><a href="/eps/docs/proxy-service/security">Security & Threat
Model</a></li>
</ul>
</li>
<li><a class="" href="#" data-toggle="collapse" data-target=
"page-sd-nav">Service Directory</a>
<ul class="is-hidden" id="page-sd-nav">
<li><a href="/eps/docs/service-directory">Overview</a></li>
<li><a href=
"/eps/docs/service-directory/installation">Installation</a></li>
<li><a href=
"/eps/docs/service-directory/configuration">Configuration</a></li>
</ul>
</li>
<li><a href="/eps/docs/contact">Contact</a></li>
<li><a href="#" data-toggle="collapse" data-target=
"menu-language-dropdown">Languages</a>
<ul id="menu-language-dropdown" class="is-hidden">
<li><a class="is-open is-active" href=
"/eps/docs/proxy-service/security">English</a></li>
</ul>
</li>
</ul>
</aside>
</div>
<div class="with-comments">
<div class="comments"></div>
<section class="section first">
<div class="content">
<div class="content markdown">
<h1>Proxy Security & Threat Model</h1>
<p>The public proxy is designed to mediate communication between a
client and a private proxy endpoint without breaking up the TLS
encryption between these two. It achieves this by instrumenting the
TLS handshake, notably by parsing the <code>ClientHello</code>
packet sent by the client to initiate the connection to the private
proxy. This packet is described in RFC-5246 <sup class=
"footnote-ref" id="fnref-1"><a href="#fn-1">1</a></sup> and
normally contains a <code>ServerNameList</code> extension as
described in RFC-6066 <sup class="footnote-ref" id=
"fnref-2"><a href="#fn-2">2</a></sup> which indicates the server
name that the client wants to establish a connection to. HTTPs
servers typcially use this information to select the appropriate
certificate, as often a single server hosts content for many
domains. Likewise, the public proxy can use this information to
determine which private proxy (if any) can handle the connection
from the client. It can then open a TCP connection to this private
proxy and forward the entire TCP stream (including the
<code>HelloClient</code> packet) to it. In doing so the public
proxy acts as an untrusted man in the middle between the client and
the private proxy, passing encrypted data between them.</p>
<h2>Threat Model</h2>
<p>Our threat model assumes that the public proxy can become fully
compromised. In scenario 1, an adversary gains full control of the
public proxy server and is able to replace the server code with his
own code that aims to e.g. exfiltrate the data exchanged between
the client and the private proxy. In scenario 2, an adversary
succeeds in redirecting traffic destined for the public proxy to
his own server, where like in scenario 1 he can run arbitrary code
to e.g. exfiltrate data.</p>
<p>Both scenarios represent a man in the middle (MITM) attack.
Systems implementing TLS are designed to mitigate such attacks
using a chain of trust provided by a public-key infrastructure.
Under ideal circumstances, this will make it impossible for a MITM
adversary to provide a valid TLS certificate to the client, who
will then refuse to establish a connection with the server.
However, with the introduction of the ACME protocol <sup class=
"footnote-ref" id="fnref-3"><a href="#fn-3">3</a></sup> it has
become possible for an adversary to easily generate a valid TLS
certificate for a hostname whose server endpoint he controls. In
both scenarios above this would enable the adversary to use an ACME
provider like LetsEncrypt in order to generate a valid TLS
certificate and then terminate and proxy the client-server TLS
connection without knowledge of either the client or the
server.</p>
<p>In order to mitigate this risk, certificate issuance via ACME
should be restricted for all hostnames that are mediated through
the public proxy. In addition, <a href=
"https://developer.mozilla.org/en-US/docs/Web/Security/Certificate_Transparency">
certificate transparency (CT) mechanisms</a> should be used to
enable the client to discover the misissuance of a certificate by a
MITM adversary.</p>
<p>An independent risk inherent in scenarios 1 & 2 is the ability
of the adversary to record the meta-data of the encrypted
connection, which can also reveal sensitive information. To reduce
this risk, meta-data obfuscation techniques should be applied to
the client-server communication.</p>
<p>Finally, the adversaries from scenarios 1 & 2 can also deny
service to the client and server by disrupting the communication
between them. This risk cannot be easily mitigated in these
scenarios, given the privileged position of the adversaries.
Denial-of-Service (DoS) attacks by external adversaries can be
mitigated using common techniques that won't be discussed here.</p>
<div class="footnotes">
<hr>
<ol>
<li id="fn-1">
<p><a href=
"https://datatracker.ietf.org/doc/html/rfc5246">RFC-5264</a>&nbsp;<a href="#fnref-1"
class="footnoteBackLink" title=
"Jump back to footnote 1 in the text.">↩</a></p>
</li>
<li id="fn-2">
<p><a href=
"https://datatracker.ietf.org/doc/html/rfc6066#section-3">RFC-6066</a>&nbsp;<a href="#fnref-2"
class="footnoteBackLink" title=
"Jump back to footnote 2 in the text.">↩</a></p>
</li>
<li id="fn-3">
<p><a href=
"https://datatracker.ietf.org/doc/html/rfc8555">RFC-8555</a>&nbsp;<a href="#fnref-3"
class="footnoteBackLink" title=
"Jump back to footnote 3 in the text.">↩</a></p>
</li>
</ol>
</div>
</div>
</div>
</section>
</div>
</div>
<script defer type="text/javascript" src=
"/eps/docs/static/js/bulma.js"></script>
</body>
</html>
